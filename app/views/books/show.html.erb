<% if flash[:notice] %>
  <p id="notice"><a class="close" data-dismiss="alert" href="#">&times;</a><%= notice %></p>
<% end %>

<p>
  <b>Name:</b>
  <%= @book.name %>
</p>

<p>
  <b>Price:</b>
  <%= yen @book.price %>
</p>

<p>
  <b>Isbn:</b>
  <%= @book.isbn %>
</p>

<hr />
<% if @book.left? %>
  <% if current_user %>
    <%= form_for(current_user.rentals.build(:book_id => @book.to_param)) do |f| %>
      <%= f.hidden_field :book_id %>
      <%= f.hidden_field :user_id %>
      <%= f.submit %>
    <% end %>
  <% else %>
    この本を借りるには 
    <%= link_to "ログイン", "/auth/twitter" %>
    して下さい。
  <% end %>
<% else %>
    <p>この本はすべて貸し出し中です。</p>
  <% if current_user && @book.borrowed_users.include?(current_user) %>
    <%= link_to '本を返す', give_back_rental_path(current_user.rentals.borrowed.select{|x| x.book == @book}.first), :class => "btn btn-warning" %>
  <% end %>
<% end %>

<div id="rental-history">
<h2>貸し出し状況</h2>
<table class="table table-condensed table-striped">
  <tr>
    <th>User</th>
    <th>作成日時</th>
    <th>更新日時</th>
    <th>返却日時</th>
  </tr>
<% @book.rentals.each do |rental| %>
  <tr>
    <td><%= rental.user.name -%></td>
    <td><%= rental.created_at -%></td>
    <td><%= rental.updated_at -%></td>
    <td><%= rental.returned_at || "貸し出し中" %></td>
  </tr>
<% end -%>



<%= link_to 'Edit', edit_book_path(@book) %> |
<%= link_to 'Back', books_path %>
</div>